<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonics & Tracing Fun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Comic Neue', cursive;
            touch-action: none; /* Prevents scrolling on canvas touch */
        }
        .letter-display {
            font-size: 10rem;
            line-height: 1;
        }
        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 400px;
            border-radius: 1.5rem;
            overflow: hidden;
        }
        #tracing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            z-index: 10;
        }
        .trace-letter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18rem;
            color: #e5e7eb; /* gray-200 */
            z-index: 5;
            pointer-events: none; /* Allows drawing over the letter */
        }
        .nav-button {
            transition: transform 0.1s ease-in-out;
        }
        .nav-button:active {
            transform: scale(0.9);
        }
        .exercise-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .exercise-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .selected {
            border-color: #3b82f6; /* blue-500 */
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4);
        }
        .correct {
            border-color: #22c55e; /* green-500 */
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.4);
            animation: bounce 0.5s;
        }
        .incorrect {
            border-color: #ef4444; /* red-500 */
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.4);
            animation: shake 0.5s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes flash {
            0%, 100% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7); } /* orange-500 */
            50% { box-shadow: 0 0 20px 10px rgba(249, 115, 22, 0); }
        }
        .tab-button.active {
            background-color: #f97316; /* orange-500 */
            color: white;
        }
        .letter-hunt-board {
            position: relative;
            perspective: 1000px;
        }
        .letter-hunt-item {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s ease, opacity 0.3s ease;
            user-select: none;
        }

        .letter-hunt-item:hover {
            transform: scale(1.1);
        }
        .letter-hunt-item.found {
            transform: scale(0.8);
            opacity: 0;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl p-4 sm:p-8">
        <header class="text-center mb-6">
            <h1 class="text-4xl sm:text-5xl font-bold text-orange-600">Phonics & Tracing Fun!</h1>
            <p class="text-gray-500 text-lg">Learn letter sounds and practice writing.</p>
        </header>

        <!-- Tabs -->
        <div id="tabs" class="flex justify-center border-b-2 border-gray-200 mb-6 space-x-2">
            <button data-tab="learn" class="tab-button text-lg sm:text-xl px-4 sm:px-6 py-3 font-bold text-gray-600 rounded-t-lg transition-colors duration-300">Learn & Trace</button>
            <button data-tab="practice" class="tab-button text-lg sm:text-xl px-4 sm:px-6 py-3 font-bold text-gray-600 rounded-t-lg transition-colors duration-300">Practice Games</button>
            <button data-tab="hunt" class="tab-button text-lg sm:text-xl px-4 sm:px-6 py-3 font-bold text-gray-600 rounded-t-lg transition-colors duration-300">Letter Hunt</button>
        </div>

        <main id="main-content">
            <!-- Learn & Trace View -->
            <div id="learn-view" class="tab-content">
                <div class="flex flex-col lg:flex-row items-center justify-around gap-8">
                    <!-- Left Side: Letter and Sound -->
                    <div class="flex flex-col items-center gap-4">
                        <div id="letter-display-container" class="w-64 h-64 bg-green-100 border-8 border-green-300 rounded-3xl flex items-center justify-center shadow-lg cursor-pointer">
                            <span id="letter-display" class="letter-display font-bold text-green-600">a</span>
                        </div>
                        <button id="teacher-instructions-button" class="nav-button bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg text-2xl flex items-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                            Teacher Instructions
                        </button>
                    </div>

                    <!-- Right Side: Tracing Canvas -->
                    <div class="flex flex-col items-center gap-4">
                        <div class="canvas-container bg-white border-8 border-gray-300 shadow-inner">
                            <span id="trace-letter-bg" class="trace-letter select-none">a</span>
                            <canvas id="tracing-canvas"></canvas>
                        </div>
                         <button id="clear-button" class="nav-button bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-xl flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
                            Clear
                        </button>
                    </div>
                </div>

                <!-- Navigation -->
                <!-- Case Toggle -->
                <div class="flex items-center justify-center mt-8 gap-4">
                    <span class="text-2xl font-bold text-gray-500">a</span>
                    <label for="case-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="" id="case-toggle" class="sr-only peer">
                        <div class="w-14 h-8 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-orange-500"></div>
                    </label>
                    <span class="text-2xl font-bold text-gray-500">A</span>
                </div>
            </div>

            <!-- Practice Games View -->
            <div id="practice-view" class="tab-content hidden">
                 <div id="game-selection" class="flex justify-center gap-4 mb-6">
                    <!-- Game selection buttons will be inserted here -->
                </div>
                <div id="exercise-container" class="text-center">
                    <h2 id="exercise-title" class="text-3xl font-bold text-yellow-600 mb-2"></h2>
                    <div id="exercise-image" class="text-8xl my-6 flex justify-center items-center h-40"></div>
                    <div id="exercise-options" class="grid grid-cols-2 sm:grid-cols-4 gap-4 max-w-xl mx-auto">
                        <!-- Options go here -->
                    </div>
                    <button id="next-exercise-button" class="nav-button mt-8 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-xl hidden">Next Question</button>
                </div>
            </div>

            <!-- Letter Hunt View -->
            <div id="hunt-view" class="tab-content hidden">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-blue-600 mb-4">Letter Hunt!</h2>
                    <div id="hunt-mode-selection" class="flex justify-center gap-4 mb-6">
                        <button id="find-capitals-btn" class="nav-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full">Find the Capital Letters</button>
                        <button id="find-lowers-btn" class="nav-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full">Find the Small Letters</button>
                    </div>
                    <div id="hunt-board" class="letter-hunt-board p-4 bg-blue-50 rounded-2xl min-h-[300px] flex items-center justify-center">
                        <p class="text-gray-500 text-xl">Select a mode to start the game!</p>
                    </div>
                    <div id="hunt-complete-message" class="hidden mt-6"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const letterData = {
                letter: 'a',
                sound: 'ah',
                audioSrc: 'YOUR_LINK_HERE',
                examples: [ // Belizean Context Examples
                    { emoji: 'ðŸœ', name: 'ant',        startsWith: 'a' },
                    { emoji: 'ðŸŠ', name: 'alligator',  startsWith: 'a' },
                    { emoji: 'ðŸ¹', name: 'arrow',      startsWith: 'a' },
                    { emoji: 'ðŸ’ª', name: 'arm',        startsWith: 'a' },
                    { emoji: 'ðŸ¾', name: 'armadillo',  startsWith: 'a' }, // Using a paw print as a proxy
                    { emoji: 'ðŸ›‹ï¸', name: 'armchair',   startsWith: 'a' },
                ],
            };

            let isUppercase = false;
            const synth = window.speechSynthesis;
            let audioCtx; // For Web Audio API
            
            // Learn & Trace elements
            const letterDisplay = document.getElementById('letter-display');
            const traceLetterBg = document.getElementById('trace-letter-bg');
            const letterDisplayContainer = document.getElementById('letter-display-container');
            const teacherInstructionsButton = document.getElementById('teacher-instructions-button');
            const caseToggle = document.getElementById('case-toggle');
            const clearButton = document.getElementById('clear-button');

            // Canvas elements
            const canvasContainer = document.querySelector('.canvas-container');
            const canvas = document.getElementById('tracing-canvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // Practice elements
            const gameSelection = document.getElementById('game-selection');
            const exerciseContainer = document.getElementById('exercise-container');
            const exerciseTitle = document.getElementById('exercise-title');
            const exerciseImage = document.getElementById('exercise-image');
            const exerciseOptions = document.getElementById('exercise-options');
            const nextExerciseButton = document.getElementById('next-exercise-button');
            let findLetterCorrectCount = 0;

            // Tabs
            const tabs = document.getElementById('tabs');
            const learnView = document.getElementById('learn-view');
            const practiceView = document.getElementById('practice-view');
            const huntView = document.getElementById('hunt-view');
            let activeGame = 'sound-match';

            // Letter Hunt elements
            const huntBoard = document.getElementById('hunt-board');
            const findCapitalsBtn = document.getElementById('find-capitals-btn');
            const findLowersBtn = document.getElementById('find-lowers-btn');
            const huntCompleteMessage = document.getElementById('hunt-complete-message');
            let huntMode = null; // 'capital' or 'lower'
            let targetCount = 0;

            function initialize() {
                setupCanvas();
                updateLetter();
                setupGameSelection();
                setupEventListeners();
                findLetterCorrectCount = 0; // Reset counter on init
                setActiveTab('learn');
            }
            
            function setupEventListeners() {
                letterDisplayContainer.addEventListener('click', playLetterSoundWithCase);
                teacherInstructionsButton.addEventListener('click', () => playAudioFile('YOUR_TEACHER_AUDIO_LINK_HERE'));
                clearButton.addEventListener('click', clearCanvas);
                caseToggle.addEventListener('change', () => {
                    isUppercase = caseToggle.checked;
                    updateLetter();
                });

                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mouseout', stopDrawing);
                canvas.addEventListener('mousemove', draw);

                canvas.addEventListener('touchstart', startDrawing);
                canvas.addEventListener('touchend', stopDrawing);
                canvas.addEventListener('touchmove', draw);
                
                window.addEventListener('resize', setupCanvas);
                
                nextExerciseButton.addEventListener('click', () => generateExercise(activeGame));
                
                tabs.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab-button')) {
                        const tabName = e.target.dataset.tab;
                        setActiveTab(tabName);
                    }
                });

                findCapitalsBtn.addEventListener('click', () => {
                    playSound("Find the Capital letters");
                    startHuntGame('capital');
                });
                findLowersBtn.addEventListener('click', () => {
                    playSound("Find the small letters");
                    startHuntGame('lower');
                });
            }

            function setActiveTab(tabName) {
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.tab === tabName);
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('hidden', content.id !== `${tabName}-view`);
                });
                if (tabName === 'practice') {
                    findLetterCorrectCount = 0; // Reset counter when switching to practice tab
                    generateExercise(activeGame);
                } else if (tabName === 'hunt') {
                    resetHuntGame();
                }
            }

            function updateLetter() {
                const currentLetter = isUppercase ? letterData.letter.toUpperCase() : letterData.letter.toLowerCase();
                letterDisplay.textContent = currentLetter;
                traceLetterBg.textContent = currentLetter;
                clearCanvas();
                playSound(letterData.sound, 0.5); // Play sound softly on change
            }

            function playLetterSoundWithCase() {
                const caseText = isUppercase ? `Capital ${letterData.sound}` : `small ${letterData.sound}`;
                playSound(`${letterData.sound}, ${caseText}.`);
            }

            function setupGameSelection() {
                const games = [
                    { id: 'sound-match', name: 'Match the Sound' },
                    { id: 'find-letter', name: 'Capital or Lowercase?' }
                ];
                gameSelection.innerHTML = '';
                games.forEach(game => {
                    const button = document.createElement('button');
                    button.textContent = game.name;
                    button.className = 'game-select-button nav-button bg-yellow-200 text-yellow-800 font-bold py-2 px-4 rounded-full';
                    button.dataset.game = game.id;
                    button.addEventListener('click', () => {
                        activeGame = game.id;
                        generateExercise(activeGame);
                    });
                    gameSelection.appendChild(button);
                });
            }

            function playAudioFile(url, volume = 1) {
                if (!url || url === 'YOUR_LINK_HERE' || url === 'YOUR_TEACHER_AUDIO_LINK_HERE') {
                    console.warn('Audio URL is a placeholder or missing. Provide a valid link to play the sound.');
                    // As a fallback, we can use the synth voice to notify the user.
                    playSound('Teacher audio has not been set up yet.', volume);
                    return;
                }
                const audio = new Audio(url);
                audio.volume = volume;
                audio.play().catch(e => {
                    console.error("Error playing audio file:", e, "Falling back to synth.");
                    // Fallback to synth if the audio file fails to play
                    playSound(letterData.sound, volume);
                });
            }

            function playSound(soundText, volume = 1, rate = 0.8) { // Default rate is now 0.8
                if (synth.speaking) {
                    synth.cancel();
                }
                const utterance = new SpeechSynthesisUtterance(soundText);
                utterance.lang = 'en-US';
                utterance.volume = volume;
                utterance.rate = rate;
                // Try to find a good voice
                const voices = synth.getVoices();
                const englishVoice = voices.find(voice => voice.lang.startsWith('en') && voice.name.includes('Google'));
                if(englishVoice) utterance.voice = englishVoice;
                
                synth.speak(utterance);
            }

            function playTone(frequency = 440, duration = 100, type = 'sine') {
                if (!audioCtx) {
                    try {
                        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (e) {
                        console.error("Web Audio API is not supported in this browser");
                        return;
                    }
                }
                const oscillator = audioCtx.createOscillator();
                oscillator.type = type;
                oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
                oscillator.connect(audioCtx.destination);
                oscillator.start();
                setTimeout(() => oscillator.stop(), duration);
            }

            // Canvas Functions
            function setupCanvas() {
                const { width, height } = canvasContainer.getBoundingClientRect();
                canvas.width = width;
                canvas.height = height;
                ctx.strokeStyle = '#f97316'; // orange-500
                ctx.lineWidth = 20;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }

            function getPosition(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches && e.touches.length > 0) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                }
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }

            function startDrawing(e) {
                e.preventDefault();
                isDrawing = true;
                const { x, y } = getPosition(e);
                ctx.beginPath();
                ctx.moveTo(x, y);
            }

            function stopDrawing() {
                isDrawing = false;
                ctx.beginPath();
            }

            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                const { x, y } = getPosition(e);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }

            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Practice Game Functions
            function generateExercise(gameType) {
                nextExerciseButton.classList.add('hidden');
                exerciseOptions.innerHTML = '';

                // Update active game button style
                document.querySelectorAll('.game-select-button').forEach(btn => {
                    btn.classList.toggle('bg-yellow-500', btn.dataset.game === gameType);
                    if(btn.dataset.game === gameType) findLetterCorrectCount = 0; // Reset counter when switching game
                    btn.classList.toggle('text-white', btn.dataset.game === gameType);
                    btn.classList.toggle('bg-yellow-200', btn.dataset.game !== gameType);
                    btn.classList.toggle('text-yellow-800', btn.dataset.game !== gameType);
                });

                if (gameType === 'sound-match') {
                    generateSoundMatchExercise();
                } else if (gameType === 'find-letter') {
                    generateFindLetterExercise();
                }
            }

            function generateSoundMatchExercise() {
                exerciseTitle.textContent = "What sound does this start with?";
                const correctAnswer = letterData;
                const randomExample = correctAnswer.examples[Math.floor(Math.random() * correctAnswer.examples.length)];
                exerciseImage.textContent = randomExample.emoji;

                // For this game, we need other letters. Let's create some dummy ones.
                const otherLetters = [{ letter: 'b', sound: 'b' }, { letter: 'm', sound: 'm' }, { letter: 's', sound: 's' }, { letter: 't', sound: 't' }, { letter: 'p', sound: 'p' }];
                let options = [correctAnswer];
                while (options.length < 4) {
                    const randomLetter = otherLetters[Math.floor(Math.random() * otherLetters.length)];
                    if (!options.some(opt => opt.letter === randomLetter.letter)) options.push(randomLetter);
                }
                options.sort(() => Math.random() - 0.5); // Shuffle

                exerciseOptions.innerHTML = '';
                options.forEach(option => {
                    const card = document.createElement('div');
                    card.className = 'exercise-card bg-gray-100 p-4 rounded-2xl border-4 border-gray-200 flex items-center justify-center';
                    card.innerHTML = `<span class="text-6xl font-bold text-gray-700">${option.letter}</span>`;
                    card.dataset.letter = option.letter;
                    card.addEventListener('click', () => checkAnswer(card, option.letter, correctAnswer.letter, randomExample.name));
                    exerciseOptions.appendChild(card);
                });
            }

            function generateFindLetterExercise() {
                const isFindingCapital = Math.random() > 0.5;
                const instructionText = isFindingCapital ? `Click on the capital ${letterData.sound}` : `Click on the lowercase ${letterData.sound}`;
                const titleText = isFindingCapital ? "Click on the capital A" : "Click on the lowercase a";
                const targetLetter = isFindingCapital ? 'A' : 'a';
                
                exerciseTitle.textContent = titleText;
                playSound(instructionText, 1); // Uses the new default slower rate
                exerciseImage.innerHTML = ''; // Clear the emoji image
                
                // Use the options container as the game board
                exerciseOptions.className = 'grid grid-cols-2 gap-4 max-w-xl mx-auto';
                exerciseOptions.innerHTML = ''; // Clear previous options

                const options = ['A', 'a'].sort(() => Math.random() - 0.5); // Shuffle them
                const colors = ['text-blue-500', 'text-green-500', 'text-purple-500', 'text-orange-500', 'text-pink-500'];

                options.forEach((letter, index) => {
                    const card = document.createElement('div');
                    card.className = 'exercise-card bg-yellow-50 p-4 rounded-2xl border-8 border-yellow-100 flex items-center justify-center h-48';
                    
                    const colorClass = colors[index % colors.length];
                    card.innerHTML = `<span class="text-9xl font-bold ${colorClass}">${letter}</span>`;
                    card.dataset.letter = letter;

                    card.addEventListener('click', () => {
                        const isCorrect = card.dataset.letter === targetLetter;
                        checkAnswer(card, card.dataset.letter, targetLetter);
                    });
                    exerciseOptions.appendChild(card);
                });
            }

            function handleFindLetterClick(item, targetLetter, onCorrect) {
                if (item.classList.contains('found')) return;

                if (item.dataset.letter === targetLetter) {
                    playTone(880, 150, 'triangle'); // Correct "ding"
                    item.classList.add('found');
                    onCorrect();
                } else {
                    playTone(220, 200, 'square'); // Incorrect "buzz"
                    item.classList.add('incorrect');
                    setTimeout(() => item.classList.remove('incorrect'), 500);
                }
            }
            
            function checkAnswer(selectedCard, selectedLetter, correctLetter, exampleName) {
                // Disable clicking on other options
                const allCards = exerciseOptions.querySelectorAll('.exercise-card');
                allCards.forEach(c => c.style.pointerEvents = 'none');

                if (selectedLetter.toLowerCase() === correctLetter.toLowerCase()) {
                    const isFindLetterGame = !exampleName;
                    const feedback = exampleName ? `${letterData.sound} for ${exampleName}!` : 'Correct!';
                    playSound(feedback, 1);
                    selectedCard.classList.add('correct');

                    if (isFindLetterGame) {
                        findLetterCorrectCount++;
                        if (findLetterCorrectCount >= 5) {
                            celebrate();
                            findLetterCorrectCount = 0; // Reset counter
                        }
                        // Automatically go to the next question after a short delay
                        setTimeout(() => generateExercise('find-letter'), 1500);
                    } else {
                        // For the sound-match game, show the next button
                        nextExerciseButton.classList.remove('hidden');
                    }
                } else {
                    playSound('Try again', 1);
                    selectedCard.classList.add('incorrect');
                    // Highlight the correct answer
                    allCards.forEach(c => {
                        if (c.dataset.letter.toLowerCase() === correctLetter.toLowerCase()) {
                            c.classList.add('correct');
                        }
                    });
                    nextExerciseButton.classList.remove('hidden');
                }
            }

            function celebrate() {
                confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
                const appContainer = document.getElementById('app-container');
                appContainer.style.animation = 'flash 1s ease-in-out';
                setTimeout(() => {
                    appContainer.style.animation = '';
                }, 1000);
            }

            // Letter Hunt Game Functions
            function resetHuntGame() {
                huntBoard.innerHTML = '<p class="text-gray-500 text-xl">Select a mode to start the game!</p>';
                huntCompleteMessage.classList.add('hidden');
                // Reset class for practice game board
                exerciseOptions.className = 'grid grid-cols-2 sm:grid-cols-4 gap-4 max-w-xl mx-auto';
                findCapitalsBtn.classList.remove('bg-blue-700');
                findLowersBtn.classList.remove('bg-blue-700');
                huntMode = null;
            }

            function startHuntGame(mode) {
                huntMode = mode;
                huntCompleteMessage.classList.add('hidden');
                
                findCapitalsBtn.classList.toggle('bg-blue-700', mode === 'capital');
                findLowersBtn.classList.toggle('bg-blue-700', mode === 'lower');

                const lettersToHunt = [];
                const positions = [];
                const totalLetters = 30;
                const targetLetter = mode === 'capital' ? 'A' : 'a';
                const otherLetter = mode === 'capital' ? 'a' : 'A';
                targetCount = 0;

                for (let i = 0; i < totalLetters; i++) {
                    if (Math.random() > 0.4) {
                        lettersToHunt.push(targetLetter);
                        targetCount++;
                    } else {
                        lettersToHunt.push(otherLetter);
                    }
                }

                // Shuffle
                lettersToHunt.sort(() => Math.random() - 0.5);

                huntBoard.innerHTML = '';
                const boardRect = huntBoard.getBoundingClientRect();
                const itemSize = 60; // Approximate size of a letter item in pixels

                for (const letter of lettersToHunt) {
                    const item = document.createElement('div');
                    item.textContent = letter;
                    item.className = 'letter-hunt-item text-5xl font-bold flex items-center justify-center';
                    item.dataset.letter = letter;

                    // Generate non-overlapping random positions
                    let top, left, isOverlapping;
                    do {
                        isOverlapping = false;
                        top = Math.random() * (boardRect.height - itemSize);
                        left = Math.random() * (boardRect.width - itemSize);
                        for (const pos of positions) {
                            if (Math.sqrt(Math.pow(pos.left - left, 2) + Math.pow(pos.top - top, 2)) < itemSize * 0.8) {
                                isOverlapping = true;
                                break;
                            }
                        }
                    } while (isOverlapping);
                    positions.push({ top, left });

                    item.style.top = `${top}px`;
                    item.style.left = `${left}px`;

                    // Add some visual variety
                    const colors = ['text-blue-500', 'text-green-500', 'text-purple-500', 'text-orange-500', 'text-pink-500'];
                    item.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                    item.style.transform = `rotate(${Math.random() * 40 - 20}deg) scale(${Math.random() * 0.4 + 0.8})`;

                    item.addEventListener('click', handleHuntClick);
                    huntBoard.appendChild(item);
                }
            }

            function handleHuntClick(e) {
                const clickedItem = e.target;
                if (clickedItem.classList.contains('found')) return;

                const clickedLetter = clickedItem.dataset.letter;
                const targetLetter = huntMode === 'capital' ? 'A' : 'a';

                if (clickedLetter === targetLetter) {
                    playTone(880, 150, 'triangle'); // Correct "ding" sound
                    clickedItem.classList.add('found', 'correct');
                    targetCount--;
                    if (targetCount === 0) {
                        gameWon();
                    }
                } else {
                    playTone(220, 200, 'square'); // Incorrect "buzz" sound
                    clickedItem.classList.add('incorrect');
                    setTimeout(() => clickedItem.classList.remove('incorrect'), 500);
                }
            }

            function gameWon() {
                playSound('You did it!', 1);
                huntCompleteMessage.innerHTML = `<p class="text-2xl font-bold text-green-600">You found them all!</p><button id="play-again-btn" class="nav-button mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full">Play Again</button>`;
                huntCompleteMessage.classList.remove('hidden');
                document.getElementById('play-again-btn').addEventListener('click', () => startHuntGame(huntMode));
            }

            // Initial call
            // We need to wait for voices to load for better speech synthesis
            if (synth.getVoices().length === 0) {
                synth.onvoiceschanged = initialize;
            } else {
                initialize();
            }

        });
    </script>

</body>
</html>
